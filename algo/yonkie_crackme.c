#include <windows.h>
#include <wincrypt.h>
#include <stdbool.h>
#include <stdint.h>

uint32_t crc32(const void* data, unsigned int length)
{
	static const uint32_t crc32tab[16] = {
	0x00000000, 0x1DB71064, 0x3B6E20C8, 0x26D930AC, 0x76DC4190,
	0x6B6B51F4, 0x4DB26158, 0x5005713C, 0xEDB88320, 0xF00F9344,
	0xD6D6A3E8, 0xCB61B38C, 0x9B64C2B0, 0x86D3D2D4, 0xA00AE278,
	0xBDBDF21C
	};
	uint8_t* buf = (uint8_t*)data;
	uint32_t crc = 0xFFFFFFFF;
	uint32_t i;
	if (length == 0) {
		return 0;
	}
	for (i = 0; i < length; ++i) {
		crc ^= buf[i];
		crc = crc32tab[crc & 0x0F] ^ (crc >> 4);
		crc = crc32tab[crc & 0x0F] ^ (crc >> 4);
	}
	return crc ^ 0xFFFFFFFF;
}

void init()
{

}

void process_serial(char *name, char *serial_out)
{
	BYTE hash_bytes[16] = { 0 };
	int namelen = lstrlen(name);
	uint32_t crc_ = crc32(name, namelen);
	//generated by a C runtime RNG with seed 0x12345678
	BYTE buffer1[0x10]={0xE9, 0x3F, 0x0D, 0xA1, 0x96, 0x95, 0x31, 0x04, 0x49, 0x2D, 0x9E, 0x61, 0x83, 0xCF, 0x09, 0x6F};

	wsprintf(serial_out, "%04X", crc_);
}


